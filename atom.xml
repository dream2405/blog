<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://dream2405.github.io/blog/</id>
    <title>낙서장 Blog</title>
    <updated>2025-09-01T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://dream2405.github.io/blog/"/>
    <subtitle>낙서장 Blog</subtitle>
    <icon>https://dream2405.github.io/blog/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Monads and more]]></title>
        <id>https://dream2405.github.io/blog/monads-and-more/</id>
        <link href="https://dream2405.github.io/blog/monads-and-more/"/>
        <updated>2025-09-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[banner]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" alt="banner" src="https://dream2405.github.io/blog/assets/images/image-00cc092da462a610f16e1795684384d2.png" width="1198" height="508" class="img_ev3q"></p>
<p>하스켈에서는 parameterised type에 함수를 적용할 수 있는 여러 방법들이 있다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functors">Functors<a href="https://dream2405.github.io/blog/monads-and-more/#functors" class="hash-link" aria-label="Functors에 대한 직접 링크" title="Functors에 대한 직접 링크">​</a></h2>
<p>다음과 같은 간단한 함수들을 보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">n</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">ns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token hvariable">ns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">sqr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">sqr</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">sqr</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">n</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">ns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token operator" style="color:#393A34">^</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hvariable">sqr</span><span class="token plain"> </span><span class="token hvariable">ns</span><br></span></code></pre></div></div>
<p>이 두 함수의 차이는 리스트의 각 원소에 적용되는 함수 뿐이다.<br>
<!-- -->이러한 패턴은 라이브러리 함수 <code>map</code>으로 간단히 정의할 수 있다.</p>
<p>우선 라이브러리 함수 <code>map</code>을 살펴보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">map</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">map</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">map</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">map</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">xs</span><br></span></code></pre></div></div>
<p>위의 두개의 함수는 다음과 같이 간단하게 정의된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">map</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">sqr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">map</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">^</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>이 예시에서 볼 수 있듯이, <code>map</code>은 리스트에서의 각 원소에 대한 함수를 매핑 한다.<br>
<!-- -->그렇다면, 리스트 뿐만이 아닌 다른 자료구조, 더 나아가 여러 parameterised type들에 대해서도 일반화할 수 있지 않을까?</p>
<p>이러한 매핑 함수를 지원하는 타입의 클래스를 <strong>Functor</strong>라고 한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><br></span></code></pre></div></div>
<p>parameterised type <code>f</code>가 <code>Functor</code> 클래스의 인스턴스가 되려면, 명시된 타입의 <code>fmap</code> 함수를 지원해야 한다.<br>
<code>fmap</code>은 <code>a -&gt; b</code> 타입의 함수와, 원소의 타입이 <code>a</code>인 <code>f a</code> 구조를 받아서, 그 함수를 각 원소에 적용한 결과로 원소의 타입이 <code>b</code>가 된 <code>f b</code> 구조를 생성한다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="예시">예시<a href="https://dream2405.github.io/blog/monads-and-more/#%EC%98%88%EC%8B%9C" class="hash-link" aria-label="예시에 대한 직접 링크" title="예시에 대한 직접 링크">​</a></h3>
<p>리스트 타입은 <code>fmap</code>을 <code>map</code> 함수로 간단히 정의함으로써 펑터로 만들 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- fmap :: (a -&gt; b) -&gt; [a] -&gt; [b]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">map</span><br></span></code></pre></div></div>
<p>이 선언에서 <code>[]</code> 기호는 타입 매개변수가 없는 리스트 타입을 나타낸다. 이는 <code>[a]</code> 타입이 리스트 타입 <code>[]</code>을 매개변수 타입 <code>a</code>에 적용한 <code>[] a</code>라는 더 원시적인 형태로도 쓰일 수 있다는 사실에 근거한다.</p>
<p>또한, 위 코드에서 <code>fmap</code>의 타입이 명시적으로 선언되지 않고 주석으로 작성된 점에 주목해야 한다. 이는 하스켈이 인스턴스 선언에 이러한 타입 정보를 허용하지 않기 때문이다. 하지만 <code>fmap</code>의 정의를 드러내고 문서화를 위해, 타입을 주석으로 포함했다.</p>
<p><br>
<!-- -->두 번째 예시로, 실패하거나 성공할 수 있는 <code>a</code> 타입의 값을 나타내는 내장 타입 <code>Maybe a</code>를 떠올려 보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">a</span><br></span></code></pre></div></div>
<p>다음과 같이 적절한 타입의 <code>fmap</code> 함수를 정의하면 간단히 <code>Maybe</code> 타입을 펑터로 만들 수 있다.<br>
<!-- -->(펑터를 나타내는 <code>f</code>와의 혼동을 피하고자 인자로 받는 함수를 <code>g</code>라고 부름)</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>즉, 실패한 값(<code>Nothing</code>)에 함수를 매핑하면 실패가 그대로 전파되는 결과가 나오고, 성공한 값(<code>Just</code>)의 경우에는 내부 값에 함수를 적용한 후 다시 태그를 붙인다.</p>
<p>사용 예를 들면 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token builtin">not</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">True</span><br></span></code></pre></div></div>
<p><br>
<!-- -->사용자 정의 타입 또한 펑터로 만들 수 있다. 예를 들어, leaf에 데이터를 갖는 이진 트리 타입을 선언한다고 가정해 보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">deriving</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Show</span><br></span></code></pre></div></div>
<p><code>deriving Show</code> 구문은 트리가 화면에 표시될 수 있도록 보장한다. 그 후, 매개변수화된 타입 <code>Tree</code>는 주어진 함수를 트리의 각 잎 값에 적용하는 <code>fmap</code> 함수를 정의함으로써 펑터로 만들 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- fmap :: (a -&gt; b) -&gt; Tree a -&gt; Tree b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token plain"> </span><span class="token hvariable">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">r</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>예를 들면 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token builtin">length</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"abc"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token builtin">even</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>하스켈에서 사용되는 많은 펑터 <code>f</code>는 위 세 예시와 유사하다. 즉, <code>f a</code>가 <code>a</code> 타입의 원소를 포함하는 자료 구조라는 의미에서 때로 <strong>컨테이너 타입(container type)</strong> 이라 불리며, <code>fmap</code>은 주어진 함수를 각 원소에 적용한다.</p>
<p>하지만 모든 인스턴스가 이 패턴에 들어맞는 것은 아니다. 예를 들어, <code>IO</code> 타입은 일반적인 의미의 컨테이너 타입이 아니다. 왜냐하면 그 값은 우리가 내부 구조에 접근할 수 없는 입출력 액션(action)을 나타내기 때문이다. 하지만 이는 쉽게 펑터로 만들 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- fmap :: (a -&gt; b) -&gt; IO a -&gt; IO b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>이 경우, <code>fmap</code>은 인자로 주어진 액션의 결과 값에 함수를 적용하며, 이를 통해 그러한 값들을 처리하는 수단을 제공한다. 예를 들면 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token builtin">show</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"True"</span><br></span></code></pre></div></div>
<p><br>
<!-- -->펑터를 사용하는 핵심적인 이점 두 가지</p>
<ol>
<li><code>fmap</code> 함수는 펑터의 성질을 만족하는(functorial) 어떤 구조의 원소든 처리하는 데 사용됨<br>
<!-- -->즉, 각 인스턴스마다 별개의 함수 이름을 만들어낼 필요 없이, 본질적으로 동일한 역할을 하는 함수들에 대해 같은 이름을 사용할 수 있다.</li>
<li>어떤 펑터에나 사용할 수 있는 일반화된(generic) 함수를 정의<br>
<!-- -->예를 들어, 리스트의 각 정수를 1씩 증가시키던 이전의 함수는 <code>map</code> 대신 <code>fmap</code>을 사용하기만 하면 어떤 펑터 타입에도 적용되도록 일반화할 수 있다.</li>
</ol>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>예를 들면 다음과 같다</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">inc</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="functor-laws">Functor laws<a href="https://dream2405.github.io/blog/monads-and-more/#functor-laws" class="hash-link" aria-label="Functor laws에 대한 직접 링크" title="Functor laws에 대한 직접 링크">​</a></h3>
<p>명시된 타입의 <code>fmap</code> 함수를 제공하는 것 외에도, 펑터는 두 가지 등식 법칙을 만족해야 한다.</p>
<ul>
<li><code>fmap id</code> = <code>id</code></li>
<li><code>fmap (g . h)</code> = <code>fmap g . fmap h</code></li>
</ul>
<p>첫 번째 등식은 <code>fmap</code>이 <strong>항등 함수(identity function)를 보존</strong>한다는 것을 의미한다.<br>
<!-- -->즉, <code>fmap</code>을 항등 함수에 적용하면 결과로 같은 항등 함수를 반환한다. 하지만 이 등식에서 <code>id</code>는 두 번 나타나지만 서로 타입이 다르다는 점에 유의해야 한다. 좌변의 <code>id</code>는 <code>a -&gt; a</code> 타입을 가지므로 <code>fmap id</code>의 타입은 <code>f a -&gt; f a</code>가 된다. 따라서 등식이 성립하려면 우변의 <code>id</code> 또한 <code>f a -&gt; f a</code> 타입을 가져야만 한다.</p>
<p>두 번째 등식은 <code>fmap</code>이 <strong>함수 합성을 보존</strong>한다는 것을 의미한다.<br>
<!-- -->즉, 두 함수의 합성에 <code>fmap</code>을 적용하는 것은, 두 함수 각각에 <code>fmap</code>을 적용한 뒤 그 결과를 합성하는 것과 결과가 같다. 이 합성이 타입 검사를 통과하려면, 구성 요소인 함수 <code>g</code>와 <code>h</code>는 각각 <code>b -&gt; c</code>와 <code>a -&gt; b</code> 타입을 가져야 한다.</p>
<p><code>fmap</code>의 다형적 타입과 결합된 이 펑터 법칙들은 <code>fmap</code>이 실제로 매핑(mapping) 연산을 수행하도록 보장한다. 예를 들어, 리스트의 경우 이 법칙들은 원소가 추가되거나, 제거되거나, 재배열되지 않고 인자로 주어진 리스트의 구조가 보존됨을 보장한다.</p>
<p>만약 내장 리스트 펑터를 리스트 원소의 순서를 뒤집는 <code>fmap</code>의 대체 버전으로 교체했다고 가정해 보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- fmap :: (a -&gt; b) -&gt; f a -&gt; f b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>(만약 이 예제를 GHCi에서 실행해보고 싶다면, 내장 리스트 펑터와의 충돌을 피하기 위해 위 선언을 수정하여 자신만의 리스트 타입을 먼저 선언해야 한다.) 이 선언은 타입은 올바르지만, 다음 예제에서 보듯이 펑터 법칙을 만족하지 못한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token builtin">id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token builtin">even</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token builtin">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token builtin">even</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>우리가 예제 섹션에서 정의했던 모든 펑터들은 펑터 법칙을 만족한다. 사실, 하스켈의 어떤 매개변수화된 타입에 대해, 필요한 법칙들을 만족하는 <code>fmap</code> 함수는 기껏해야 하나뿐이다. 즉, 주어진 매개변수화된 타입을 펑터로 만들 수 있는 방법이 있다면, 그 방법은 단 하나뿐이라는 것이다. 따라서 우리가 정의했던 리스트, <code>Maybe</code>, <code>Tree</code>, <code>IO</code>에 대한 인스턴스들은 모두 유일하게 결정된 것이다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="applicatives">Applicatives<a href="https://dream2405.github.io/blog/monads-and-more/#applicatives" class="hash-link" aria-label="Applicatives에 대한 직접 링크" title="Applicatives에 대한 직접 링크">​</a></h2>
<p>펑터는 구조의 각 원소 위로 함수를 매핑한다는 아이디어를 추상화한다. 이제 이 아이디어를 일반화하여, 단일 인자를 갖는 함수에 제약되는 대신 임의의 개수의 인자를 갖는 함수를 매핑할 수 있도록 하고 싶다고 가정해 보자. 더 정확히는, 다음과 같은 타입을 갖는 <code>fmap</code> 함수들의 계층을 정의하고 싶다고 가정해 보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">fmap0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p><code>fmap1</code>은 <code>fmap</code>의 다른 이름일 뿐이고, <code>fmap0</code>는 매핑되는 함수가 인자를 갖지 않는 퇴화된(degenerate) 경우이다. 한 가지 가능한 접근법은 각 경우에 대해 펑터 클래스의 특별한 버전(Functor0, Functor1, Functor2 등)을 선언하는 것이다. 그러면 예를 들어 다음과 같이 쓸 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">fmap2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><br></span></code></pre></div></div>
<p>하지만 이 방법은 여러 면에서 만족스럽지 않다.</p>
<ul>
<li>모든 펑터 클래스들이 유사한 패턴을 따름에도 불구하고 각 버전을 수동으로 선언해야 한다.</li>
<li>무한히 많은 클래스가 있지만 우리는 유한한 수만 선언할 수 있으므로, 얼마나 많은 클래스를 선언해야 할지 명확하지 않다.</li>
</ul>
<p><code>(a -&gt; b) -&gt; f a -&gt; f b</code> 타입의 <code>fmap</code>을 <code>(a -&gt; b) -&gt; a -&gt; b</code> 타입의 내장 함수 적용 연산자를 일반화한 것으로 간주한다면, 원하는 동작을 달성하기 위해 일종의 <strong>커링(currying)</strong> 을 사용할 수 있을 것이라 기대할 수 있다. 특히, 우리는 <code>add x y = x + y</code>와 같은 정의에서 커링에 의존할 뿐, 인자 개수가 다른 함수들을 위해 특별한 버전의 적용(application)을 필요로 하지 않는다.</p>
<p><br>
<!-- -->커링(currying)의 아이디어를 사용하면, 임의의 인자 개수를 갖는 함수를 위한 <code>fmap</code>의 버전은 다음 두 가지 기본 함수의 타입으로 구성될 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><br></span></code></pre></div></div>
<p>즉, <code>pure</code>는 <code>a</code> 타입의 값을 <code>f a</code> 타입의 구조로 변환하는 반면, <code>&lt;*&gt;</code>는 인자로 주어지는 함수, 인자 값, 그리고 결과 값이 모두 <code>f</code> 구조 안에 포함되는, 일반화된 형태의 함수 적용이다. 일반적인 함수 적용과 마찬가지로 <code>&lt;*&gt;</code> 연산자는 두 인자 사이에 중위(infix) 표기법으로 사용되며 왼쪽 결합(left-associative)을 한다고 가정한다.<br>
<!-- -->예를 들어, <code>g &lt;*&gt; x &lt;*&gt; y &lt;*&gt; z</code>는 다음과 같이 해석된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">z</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>pure</code>와 <code>&lt;*&gt;</code>의 전형적인 사용 형태는 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">x1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">x2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">xn</span><br></span></code></pre></div></div>
<p>이러한 표현식은 <strong>어플리커티브 스타일(applicative style)</strong> 이라고 한다. 이는 일반적인 함수 적용 표기법인 <code>g x1 x2 ... xn</code>과의 유사성 때문이다. 두 경우 모두, <code>g</code>는 <code>a1 ... an</code> 타입의 인자 n개를 받아 <code>b</code> 타입의 결과를 생성하는 커링된 함수이다. 하지만 어플리커티브 스타일에서는 각 인자 <code>xi</code>가 <code>ai</code>가 아닌 <code>f ai</code> 타입을 가지며, 전체 결과 또한 <code>b</code>가 아닌 <code>f b</code> 타입을 갖는다. 이 아이디어를 사용하여 매핑 함수의 계층을 다음과 같이 정의할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">fmap0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap1</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap2</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fmap3</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token hvariable">z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">z</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>이 정의들의 타입을 직접 확인해보는 것은 좋은 연습이 된다. 하지만 실제로는 다음 섹션에서 보게 될 것처럼 필요에 따라 구성될 수 있으므로 이러한 매핑 함수들을 명시적으로 정의할 필요는 거의 없다.</p>
<p><code>pure</code>와 <code>&lt;*&gt;</code> 개념을 지원하는 펑터를 어플리커티브 펑터(applicative functors), 줄여서 <strong>어플리커티브(applicatives)</strong> 라고 부른다. 하스켈에서 이 개념은 다음과 같은 내장 클래스 선언으로 구현된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">pure</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">b</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="예시-1">예시<a href="https://dream2405.github.io/blog/monads-and-more/#%EC%98%88%EC%8B%9C-1" class="hash-link" aria-label="예시에 대한 직접 링크" title="예시에 대한 직접 링크">​</a></h3>
<p><code>Maybe</code>가 <code>fmap</code>을 지원하는 펑터라는 사실을 이용하면, 이 타입을 어플리커티브 펑터로 만드는 것은 간단하다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- pure :: a -&gt; Maybe a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&lt;*&gt;) :: Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">mx</span><br></span></code></pre></div></div>
<p>즉, <code>pure</code> 함수는 값을 성공적인 결과(<code>Just</code>)로 변환하는 반면, <code>&lt;*&gt;</code> 연산자는 실패할 수도 있는 인자에 실패할 수도 있는 함수를 적용하여 결과를 생성한다.</p>
<p>예를 들면 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Nothing</span><br></span></code></pre></div></div>
<p>이러한 방식으로, <code>Maybe</code>의 어플리커티브 스타일은 실패 전파를 어플리커티브의 자동화된 메커니즘이 처리해주므로, 우리가 직접 실패 가능성이 있는 인자에 순수 함수를 적용하는 것을 관리할 필요가 없는 형태의 예외 처리 프로그래밍을 지원한다.</p>
<p><br>
<!-- -->이제 리스트 타입으로 넘어가 보자. 표준적인 인스턴스 선언은 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- pure :: a -&gt; [a]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&lt;*&gt;) :: [a -&gt; b] -&gt; [a] -&gt; [b]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">gs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">gs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>즉, <code>pure</code>는 값을 원소가 하나인 리스트(singleton list)로 변환하고, <code>&lt;*&gt;</code>는 함수들의 리스트와 인자들의 리스트를 받아, 각 함수를 각 인자에 적용하여 모든 결과를 리스트로 반환한다. 예를 들면 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>이 예제들을 어떻게 이해해야 할까? 핵심은 <code>[a]</code> 타입을 성공 시 여러 결과를 허용하는 <code>Maybe a</code>의 일반화로 보는 것이다. 더 정확히는, 빈 리스트는 실패를 나타내고, 비어있지 않은 리스트는 결과가 성공할 수 있는 모든 가능한 방식을 나타낸다고 생각할 수 있다. 따라서 마지막 예제에서 첫 번째 인자는 두 개의 가능한 값(<code>1</code> 또는 <code>2</code>)을 갖고, 두 번째 인자도 두 개의 가능한 값(<code>3</code> 또는 <code>4</code>)을 가지므로, 곱셈의 결과로 네 개의 가능한 결과(<code>3, 4, 6, 8</code>)가 나오는 것이다.</p>
<p>더 일반적으로, 리스트 컴프리헨션(list comprehension)을 사용하여 두 정수 리스트를 곱하는 모든 가능한 방법을 반환하는 함수를 생각해보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">prods</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">prods</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">x</span><span class="token operator" style="color:#393A34">*</span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>리스트가 어플리커티브라는 사실을 이용하면, 중간 결과에 이름을 붙일 필요 없이 어플리커티브 정의를 내놓을 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">prods</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">prods</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">ys</span><br></span></code></pre></div></div>
<p>요약하자면, 리스트의 어플리커티브 스타일은 일종의 <strong>비결정적 프로그래밍(non-deterministic programming)</strong> 을 지원한다. 이를 통해 값의 선택이나 실패 전파를 직접 관리할 필요 없이, 순수 함수를 다중-값 인자에 적용할 수 있으며, 이는 어플리커티브의 자동화된 메커니즘이 처리해준다.</p>
<p>이 섹션에서 다룰 마지막 타입은 <code>IO</code> 타입이며, 다음 선언을 사용하여 어플리커티브 펑터로 만들 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- pure :: a -&gt; IO a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&lt;*&gt;) :: IO (a -&gt; b) -&gt; IO a -&gt; IO b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">mg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>이 경우 <code>pure</code>는 <code>IO</code> 타입을 위한 <code>return</code> 함수로 정의되고, <code>&lt;*&gt;</code>는 순수하지 않은(impure) 인자에 순수 함수를 적용하여 순수하지 않은 결과를 내놓는다. 예를 들어, 키보드로부터 주어진 개수의 문자를 읽는 함수는 어플리커티브 스타일로 다음과 같이 정의될 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">getChars</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">getChars</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">getChars</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token builtin">getChar</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">getChars</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">n</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>즉, 기본 케이스(base case)에서는 단순히 빈 리스트를 반환하고, 재귀 케이스에서는 첫 번째 문자를 읽은 결과와 나머지 문자 리스트에 리스트 생성자 (<code>:</code>)를 적용한다. 후자의 경우, 만약 이 함수가 <code>do</code> 표기법으로 정의되었다면 필요했을 cons 함수에 공급되는 인자들의 이름을 붙일 필요가 없다.</p>
<p>더 일반적으로, <code>IO</code>의 어플리커티브 스타일은 일종의 <strong>interactive programming</strong> 을 지원한다. 이를 통해 액션의 순서나 결과 값 추출을 직접 관리할 필요 없이, 순수 함수를 순수하지 않은 인자에 적용할 수 있으며, 이는 어플리커티브의 자동화된 메커니즘이 자동으로 처리해준다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="effectful-programming">Effectful programming<a href="https://dream2405.github.io/blog/monads-and-more/#effectful-programming" class="hash-link" aria-label="Effectful programming에 대한 직접 링크" title="Effectful programming에 대한 직접 링크">​</a></h3>
<p>어플리커티브에 대한 원래 동기는 다중 인자 함수에 대한 매핑 아이디어를 일반화하려는 것이었다. 이는 어플리커티브의 개념에 대한 한가지 유효한 해석이지만, 앞서 살펴본 세 가지 인스턴스(<code>Maybe</code>, <code>List</code>, <code>IO</code>)를 통해 더 추상적인 또 다른 관점이 있다는 것이 분명해진다.</p>
<p>이 인스턴스들 사이의 공통된 주제는 모두 <strong>effects</strong> 를 사용한 프로그래밍과 관련이 있다는 점이다. 각 경우에, 어플리커티브 메커니즘은 친숙한 어플리커티브 스타일로 프로그램을 작성하게 해주는 <code>&lt;*&gt;</code> 연산자를 제공한다. 이 스타일에서는 함수가 인자에 적용되는데, 한 가지 핵심적인 차이점이 있다. 인자들은 더 이상 단순한 값이 아니라, 실패 가능성, 여러 성공 경로, 또는 입출력 액션 수행과 같은 effect를 가질 수 있다.</p>
<p>이러한 방식으로, 어플리커티브 펑터는 순수 함수를 <strong>effectful arguments</strong>에 적용하는 아이디어를 추상화한 것으로도 볼 수 있으며, 허용되는 효과의 정확한 형태는 기반이 되는 펑터의 성질에 따라 달라진다.</p>
<p>effectful programming의 한 형태에 대한 통일된 접근법을 제공하는 것 외에도, 어플리커티브를 사용하는 것은 어떤 어플리커티브 펑터와도 함께 사용할 수 있는 일반화된 함수를 정의할 수 있다는 중요한 이점도 있다.</p>
<p>한 예로, 표준 라이브러리는 다음 함수를 제공한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">sequenceA</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">sequenceA</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">sequenceA</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">sequenceA</span><span class="token plain"> </span><span class="token hvariable">xs</span><br></span></code></pre></div></div>
<p>이 함수는 어플리커티브 액션들의 리스트를, 결과 값들의 리스트를 반환하는 단일 액션으로 변환하며, 어플리커티브 프로그래밍의 공통된 패턴을 포착한다. 예를 들어, <code>getChars</code> 함수는 이제 기본 액션인 <code>getChar</code>를 필요한 횟수만큼 복제하고 그 결과 시퀀스를 실행하는 더 간단한 방식으로 정의될 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">getChars</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">getChars</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">sequenceA</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">replicate</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token builtin">getChar</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="applicative-laws">Applicative laws<a href="https://dream2405.github.io/blog/monads-and-more/#applicative-laws" class="hash-link" aria-label="Applicative laws에 대한 직접 링크" title="Applicative laws에 대한 직접 링크">​</a></h3>
<p><code>pure</code>와 <code>&lt;*&gt;</code> 함수를 제공하는 것 외에도, 어플리커티브 펑터는 네 가지 등식 법칙을 만족해야 한다.</p>
<ul>
<li><code>pure id &lt;*&gt; x</code> = <code>x</code>
<ul>
<li><strong>항등(Identity)</strong> : <code>pure</code>가 항등 함수를 보존한다는 것을 말한다. 즉, <code>pure id</code>를 적용하는 것은 아무것도 하지 않는 것과 같다.</li>
</ul>
</li>
<li><code>pure (g x)</code> = <code>pure g &lt;*&gt; pure x</code>
<ul>
<li><strong>동형사상(Homomorphism)</strong> : <code>pure</code>가 함수 적용 또한 보존함을 말한다. <code>pure</code>는 일반적인 함수 적용을 어플리커티브 함수 적용으로 분배할 수 있다.</li>
</ul>
</li>
<li><code>x &lt;*&gt; pure y</code> = <code>pure (\g -&gt; g y) &lt;*&gt; x</code>
<ul>
<li><strong>교환(Interchange)</strong> : effectful 함수를 순수한(pure) 인자에 적용할 때, 두 구성 요소의 평가 순서는 중요하지 않다는 것을 말한다.</li>
</ul>
</li>
<li><code>x &lt;*&gt; (y &lt;*&gt; z)</code> = <code>(pure (.) &lt;*&gt; x &lt;*&gt; y) &lt;*&gt; z</code>
<ul>
<li><strong>결합(Composition)</strong> : 관련된 타입들을 제외하면 <code>&lt;*&gt;</code> 연산자가 결합 법칙을 만족한다는 것을 말한다.</li>
</ul>
</li>
</ul>
<p>이 어플리커티브 법칙들은 <code>pure :: a -&gt; f a</code> 함수에 대한 우리의 직관, 즉 <code>a</code> 타입의 값을 <code>f</code> 타입의 세상에 심는다는 개념을 공식화한다. 또한 이 법칙들은 <code>pure</code> 함수와 <code>&lt;*&gt;</code> 연산자를 사용하여 구축된 모든 타입이 올바른 표현식은 어플리커티브 스타일로 다시 작성될 수 있음을 보장한다. 즉, 다음과 같은 형태이다.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pure g &lt;*&gt; x1 &lt;*&gt; x2 &lt;*&gt; ... &lt;*&gt; xn</span><br></span></code></pre></div></div>
<p>우리가 예제에서 정의했던 모든 어플리커티브 펑터는 위 법칙들을 만족한다. 더욱이, 이 인스턴스들은 각각 <code>fmap g x = pure g &lt;*&gt; x</code> 법칙 또한 만족하는데, 이는 <code>fmap</code>이 두 어플리커티브 기본 연산(<code>pure</code>, <code>&lt;*&gt;</code>)으로 어떻게 정의될 수 있는지 보여준다. 사실 이 <code>fmap</code> 관련 법칙은 이전에 언급된 사실, 즉 주어진 매개변수화된 타입을 펑터로 만드는 방법은 단 하나뿐이므로 <code>fmap</code>과 동일해야 하는 함수는 어떤 것이든 실제로 <code>fmap</code>과 같다는 사실 덕분에 공짜로 얻어진다.</p>
<p>마지막으로, 하스켈은 <code>g &lt;$&gt; x = fmap g x</code>로 정의되는 <code>fmap</code>의 중위(infix) 버전인 <code>&lt;$&gt;</code>를 제공한다. 이를 위 <code>fmap</code> 법칙과 결합하면 어플리커티브 스타일의 대안적인 형태를 얻을 수 있다.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">g &lt;$&gt; x1 &lt;*&gt; x2 &lt;*&gt; ... &lt;*&gt; xn</span><br></span></code></pre></div></div>
<p>이 버전이 약간 더 간결하지만, 설명 목적으로는 프로그래밍이 순수 함수를 효과가 있는 인자에 적용하는 것임을 명시적으로 강조하는 <code>pure</code> 버전을 선호한다. 하지만 <code>&lt;$&gt;</code>를 사용하는 버전은 실제 응용 프로그램에서 자주 사용된다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="monads">Monads<a href="https://dream2405.github.io/blog/monads-and-more/#monads" class="hash-link" aria-label="Monads에 대한 직접 링크" title="Monads에 대한 직접 링크">​</a></h2>
<p>이 장에 나올 마지막 새로운 개념은 effectful programming의 또 다른 패턴을 포착한다. 예시로, 정수 값과 나눗셈 연산자로 구성된 다음 표현식 타입을 생각해보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><br></span></code></pre></div></div>
<p>이러한 표현식은 다음과 같이 평가될 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">`div`</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">y</span><br></span></code></pre></div></div>
<p>하지만 이 함수는 0으로 나누는 가능성을 고려하지 않으며, 이 경우 오류를 발생시킨다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">***</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Exception</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hvariable">divide</span><span class="token plain"> </span><span class="token hvariable">by</span><span class="token plain"> </span><span class="token hvariable">zero</span><br></span></code></pre></div></div>
<p>이 문제를 해결하기 위해, 두 번째 인자가 <code>0</code>일 때 <code>Nothing</code>을 반환하는 안전한 버전의 나눗셈 함수를 정의하기 위해 <code>Maybe</code> 타입을 사용할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">safediv</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">safediv</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">safediv</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">`div`</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>그리고 <code>eval</code> 함수를 수정하여 두 인자 표현식에 재귀적으로 호출될 때 실패 가능성을 명시적으로 처리하도록 한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">safediv</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token hvariable">m</span><br></span></code></pre></div></div>
<p>이제 예를 들면 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Nothing</span><br></span></code></pre></div></div>
<p>이 새로운 정의는 0으로 나누기 이슈를 해결하지만 다소 장황하다. 정의를 단순화하기 위해 <code>Maybe</code>가 어플리커티브라는 사실을 활용하여 <code>eval</code>을 어플리커티브 스타일로 재정의해볼 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">safediv</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">y</span><br></span></code></pre></div></div>
<p>하지만 이 정의는 타입이 올바르지 않다. 특히, 위 컨텍스트에서는 <code>Int -&gt; Int -&gt; Int</code> 타입의 함수가 필요한데, <code>safediv</code> 함수는 <code>Int -&gt; Int -&gt; Maybe Int</code> 타입을 갖는다. <code>pure safediv</code>를 <code>Maybe (Int -&gt; Int -&gt; Maybe Int)</code> 타입을 갖는 커스텀 정의 함수로 교체해도 도움이 되지 않는데, 이는 두 번째 정수가 0일 때 실패를 나타낼 방법이 없기 때문이다.</p>
<p>결론은 <code>eval</code> 함수가 어플리커티브 펑터가 포착하는 effectful programming의 패턴에 맞지 않는다는 것이다. 어플리커티브 스타일은 순수 함수를 효과가 있는 인자에 적용하도록 제한한다. <code>eval</code>은 이 패턴에 맞지 않는데, <code>safediv</code>를 처리하는 데 사용되는 함수가 순수 함수가 아니라 그 자체로 실패할 수 있기 때문이다.</p>
<p>그렇다면 <code>eval :: Expr -&gt; Maybe Int</code>를 어떻게 더 간단한 방식으로 다시 작성할 수 있을까? 핵심은 <code>eval</code> 정의에 두 번 나타나는 공통 패턴, 즉 <code>Maybe</code> 값에 대한 **경우 분석(case analysis)**을 수행하여 <code>Nothing</code>은 <code>Nothing</code>으로, <code>Just x</code>는 어떤 결과로 매핑하는 것을 관찰하는 것이다. 이 패턴을 추상화하면 다음과 같이 정의되는 새로운 연산자 <code>&gt;&gt;=</code>를 얻을 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">mx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x</span><br></span></code></pre></div></div>
<p>즉, <code>&gt;&gt;=</code>는 실패할 수 있는 <code>a</code> 타입의 인자와, 그 결과가 실패할 수 있는 <code>a</code> 타입의 함수를 받아, 실패할 수 있는 <code>b</code> 타입의 결과를 반환한다. 만약 첫 번째 인자가 실패하면 실패를 전파하고, 그렇지 않으면 두 번째 인자인 함수를 첫 번째 인자의 결과에 적용한다. 이런 식으로 <code>&gt;&gt;=</code>는 <code>Maybe</code> 값의 연속과 그 결과 처리를 통합한다. <code>&gt;&gt;=</code> 연산자는 종종 <strong>바인드(bind)</strong> 라고 불린다. 두 번째 인자를 첫 번째 인자의 결과에 바인딩하기 때문이다.</p>
<p>바인드 연산자와 람다 표기법을 사용하여, 이제 <code>eval</code> 함수를 더 간결한 방식으로 재정의할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token hvariable">safediv</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token hvariable">m</span><br></span></code></pre></div></div>
<p><code>Div</code>의 경우는 먼저 <code>x</code>를 평가하여 그 결과를 <code>n</code>이라 하고, 그 다음 <code>y</code>를 평가하여 그 결과를 <code>m</code>이라 한 뒤, <code>safediv</code>를 사용하여 두 결과를 결합하는 상태를 명시한다.</p>
<p>위 예제로부터 일반화하면, <code>&gt;&gt;=</code> 연산자를 사용하여 구축된 표현식은 전형적으로 다음과 같은 구조를 가진다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">m1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">x1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">m2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">x2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">mn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">xn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x1</span><span class="token plain"> </span><span class="token hvariable">x2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token hvariable">xn</span><br></span></code></pre></div></div>
<p>즉, 우리는 <code>m1 ... mn</code> 각각의 표현식을 차례로 평가하고, 그 결과 값 <code>x1 ... xn</code>을 함수 <code>f</code>에 적용하여 결합한다. <code>&gt;&gt;=</code> 연산자의 정의는 시퀀스의 모든 구성요소 <code>mi</code>가 성공할 경우에만 이러한 표현식이 성공하도록 보장한다. 더 나아가, <code>&gt;&gt;=</code> 연산자의 정의에 의해 시퀀스의 어느 지점에서든 실패를 처리하는 문제가 자동으로 처리되므로 사용자는 이에 대해 걱정할 필요가 없다.</p>
<p>하스켈은 위와 같은 형태의 표현식을 다음과 같이 더 간단한 방식으로 작성할 수 있도록 특별한 표기법을 제공한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">x1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">m1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token hvariable">x2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">m2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token hvariable">xn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x1</span><span class="token plain"> </span><span class="token hvariable">x2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token hvariable">xn</span><br></span></code></pre></div></div>
<p>이는 상호작용 프로그래밍(interactive programming)에서도 사용되는 것과 동일한 표기법이다. 여기에서도 시퀀스의 각 항목은 동일한 열에서 시작해야 하며, 결과 값 <code>xi</code>가 필요하지 않은 경우 <code>xi &lt;- mi</code>는 <code>mi</code>로 축약될 수 있다. 이 <code>do</code> 표기법을 사용하면 <code>eval</code>은 이제 다음과 같이 간단하게 재정의될 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Expr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Val</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Div</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">eval</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token hvariable">safediv</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token hvariable">m</span><br></span></code></pre></div></div>
<p>더 일반적으로, <code>do</code> 표기법은 <code>IO</code>나 <code>Maybe</code> 타입에만 국한되지 않고, <strong>모나드(monad)</strong> 를 형성하는 모든 어플리커티브 타입과 함께 사용될 수 있다. 하스켈에서 모나드의 개념은 다음과 같은 내장 선언으로 구현된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><br></span></code></pre></div></div>
<p>즉, 모나드는 명시된 타입의 <code>return</code>과 <code>&gt;&gt;=</code> 함수를 지원하는 어플리커티브 타입이다. 기본 정의 <code>return = pure</code>는 <code>return</code>이 일반적으로 어플리커티브 함수 <code>pure</code>의 다른 이름일 뿐이지만, 원한다면 인스턴스 선언에서 오버라이드(override)될 수 있음을 의미한다.</p>
<p><code>return</code> 함수는 역사적인 이유로, 그리고 <code>return</code>과 <code>&gt;&gt;=</code> 함수를 모두 포함한다고 가정하는 기존 코드, 논문, 교과서와의 하위 호환성을 보장하기 위해 <code>Monad</code> 클래스에 포함되어 있다. 하지만 미래의 어느 시점에는 <code>return</code>이 <code>Monad</code> 클래스에서 제거되고 대신 다음과 같은 정의를 갖는 라이브러리 함수가 될 수도 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">pure</span><br></span></code></pre></div></div>
<p>만약 이 변경이 구현되면, 더 이상 인스턴스 선언에서 <code>return</code>을 정의하는 것이 불가능해지지만, 우리는 일반적으로 기본 정의인 <code>return = pure</code>를 사용하므로 대부분의 예제는 영향을 받지 않을 것이다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="예시-2">예시<a href="https://dream2405.github.io/blog/monads-and-more/#%EC%98%88%EC%8B%9C-2" class="hash-link" aria-label="예시에 대한 직접 링크" title="예시에 대한 직접 링크">​</a></h3>
<p>표준 라이브러리(prelude)에서, <code>Maybe</code> 타입의 바인드(bind) 연산자는 단순성을 위해 케이스 분석 대신 패턴 매칭을 사용하여 정의된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&gt;&gt;=) :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x</span><br></span></code></pre></div></div>
<p>이 선언 때문에 <code>do</code> 표기법이 이전 섹션의 <code>eval</code> 함수에서처럼 <code>Maybe</code> 값을 프로그래밍하는 데 사용될 수 있는 것이다.</p>
<p><br>
<!-- -->리스트 또한 다음과 같이 모나드 타입으로 만들어질 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&gt;&gt;=) :: [a] -&gt; (a -&gt; [b]) -&gt; [b]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>즉, <code>xs &gt;&gt;= f</code>는 <code>xs</code>의 각 결과 <code>x</code>에 함수 <code>f</code>를 적용하고, 그 결과 값들을 모두 리스트에 모은다. 이런 식으로 리스트의 바인드 연산자는 여러 결과를 생성할 수 있는 표현식을 시퀀싱하는 수단을 제공한다. 예를 들어, 두 리스트의 원소를 짝짓는 모든 가능한 방법을 반환하는 함수는 이제 <code>do</code> 표기법을 사용하여 정의할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">pairs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">pairs</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>예를 들면 다음과 같다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">pairs</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p><code>pairs</code>의 마지막 줄에서 기본 정의인 <code>return = pure</code> 때문에 <code>pure (x,y)</code>를 쓸 수도 있었지만, 모나드 프로그래밍에서는 <code>return</code> 함수를 사용하는 것이 관례라는 점에 유의하자. 또한 이 정의가 리스트 컴프리헨션 표기법을 사용한 정의와 유사하다는 점도 흥미롭다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">pairs</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>하지만 컴프리헨션 표기법은 리스트 타입에만 특정되지만, <code>do</code> 표기법은 임의의 모나드와 함께 사용될 수 있다.</p>
<p><br>
<!-- -->표준 라이브러리는 또한 <code>IO</code> 타입에 대한 인스턴스도 포함하며, 이는 상호작용 프로그래밍을 위한 <code>do</code> 표기법 사용을 지원한다. 위의 다른 예제들과 달리, 이 경우 <code>return</code>과 <code>&gt;&gt;=</code>의 정의는 하스켈 자체 내에서 정의되기보다는 언어에 내장되어 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- return :: a -&gt; IO a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">mx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-state-monad">The state monad<a href="https://dream2405.github.io/blog/monads-and-more/#the-state-monad" class="hash-link" aria-label="The state monad에 대한 직접 링크" title="The state monad에 대한 직접 링크">​</a></h3>
<p>이제 시간에 따라 변할 수 있는 어떤 형태의 <strong>상태(state)</strong> 를 조작하는 함수를 작성하는 문제를 생각해 보자. 여기서는 간단하게 상태는 단지 정수 값이라고 가정하지만, 필요에 따라 수정될 수 있다:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><br></span></code></pre></div></div>
<p>이 타입에 대한 가장 기본적인 형태의 함수는 상태 변환자(state transformer), 약자로 ST이다. 이것은 입력 상태를 인자로 받아서 결과로 출력 상태를 만들어내며, 이때 출력 상태는 함수 실행 중에 상태에 가해진 모든 변경 사항을 반영한다:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><br></span></code></pre></div></div>
<p>하지만 일반적으로, 상태를 갱신하는 것 외에도 결과 값을 반환하고 싶을 수 있다. 예를 들어, 상태가 카운터를 나타낸다면, 카운터를 증가시키는 함수는 그것의 현재 값을 반환하고 싶을 수도 있다. 이러한 이유로, 상태 변환자의 타입을 일반화하여 결과 값도 반환하도록 하며, 이러한 값의 타입은 ST 타입의 파라미터가 된다:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><br>
<!-- -->이러한 함수는 다음과 같이 그림 형태로 표시될 수 있다. 여기서 <strong>s</strong> 는 입력 상태, <strong>s'</strong> 는 출력 상태, <strong>v</strong> 는 결과 값이다:</p>
<p><img decoding="async" loading="lazy" alt="img1" src="https://dream2405.github.io/blog/assets/images/image-1-4b495646e9cd727b5074590e84fb595c.png" width="711" height="414" class="img_ev3q"></p>
<p>반대로, 상태 변환자는 인자 값을 받고 싶을 수도 있다. 하지만 이를 고려하기 위해 ST 타입을 더 일반화할 필요는 없는데, 왜냐하면 이러한 동작은 이미 <strong>커링(currying)</strong> 을 활용하여 달성할 수 있기 때문이다. 예를 들어, 문자를 받아서 정수를 반환하는 상태 변환자는 <code>Char -&gt; ST Int</code> 타입을 가질 것이며, 이는 아래 그림과 같이 커링된 함수 타입인 <code>Char -&gt; State -&gt; (Int, State)</code>를 축약한 것이다:</p>
<p><img decoding="async" loading="lazy" alt="img2" src="https://dream2405.github.io/blog/assets/images/image-2-6f2a80a8712ad90ce8675ea8b29fc9b6.png" width="766" height="370" class="img_ev3q"></p>
<p>ST가 파라미터화된 타입이라는 점을 감안할 때, 이를 <strong>모나드(monad)</strong> 로 만들어서 상태가 있는(stateful) 프로그램을 작성하는 데 <code>do</code> 표기법을 사용할 수 있도록 시도하는 것은 자연스럽다. 하지만, <code>type</code> 메커니즘을 사용해 선언된 타입은 클래스의 인스턴스가 될 수 없다. 따라서, 먼저 newtype 메커니즘을 사용하여 <code>ST</code> 타입을 재정의하는데, 여기에는 <strong>S</strong> 라고 부르는 <strong>더미 생성자(dummy constructor)</strong> 를 도입해야 한다:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">newtype</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">State</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>또한 이 타입을 위해 더미 생성자를 단순히 제거하는 특수 목적의 적용 함수(application function)를 정의하는 것이 편리하다:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">app</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">app</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"> </span><span class="token hvariable">st</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">st</span><span class="token plain"> </span><span class="token hvariable">x</span><br></span></code></pre></div></div>
<p>파라미터화된 ST 타입을 모나드로 만들기 위한 첫 단계로서, 이 타입을 간단히 <strong>펑터(functor)</strong> 로 만들 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Functor</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- fmap :: (a -&gt; b) -&gt; ST a -&gt; ST b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">fmap</span><span class="token plain"> </span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">st</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">s</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">s'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">app</span><span class="token plain"> </span><span class="token hvariable">st</span><span class="token plain"> </span><span class="token hvariable">s</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">g</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">s'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>즉, <code>fmap</code>은 다음 그림에서처럼 상태 변환자의 결과 값에 함수를 적용하게 해준다.</p>
<p><img decoding="async" loading="lazy" alt="img3" src="https://dream2405.github.io/blog/assets/images/image-3-bb2d4b50372b25c23a25dc81bd475db7.png" width="1245" height="322" class="img_ev3q"></p>
<p>위 정의에 사용된 하스켈의 <code>let</code> 메커니즘은 <code>where</code> 메커니즘과 유사하지만, 함수 정의 수준이 아닌 표현식 수준에서 local definition을 할 수 있게 해준다는 점이 다르다.
결과적으로, <code>ST</code> 타입은 <strong>어플리커티브 펑터(applicative functor)</strong> 로 만들어질 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Applicative</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- pure :: a -&gt; ST a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">pure</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">s</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&lt;*&gt;) :: ST (a -&gt; b) -&gt; ST a -&gt; ST b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">stf</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">stx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">s</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">s'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">app</span><span class="token plain"> </span><span class="token hvariable">stf</span><span class="token plain"> </span><span class="token hvariable">s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">s''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">app</span><span class="token plain"> </span><span class="token hvariable">stx</span><span class="token plain"> </span><span class="token hvariable">s'</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">s''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>이 경우, <code>pure</code> 함수는 어떤 값을 상태 변경 없이 그대로 반환하는 상태 변환자로 변환한다.</p>
<p><img decoding="async" loading="lazy" alt="img4" src="https://dream2405.github.io/blog/assets/images/image-4-b23eb98ddf23f9eeb8a8bb8e79d6bc43.png" width="902" height="320" class="img_ev3q"></p>
<p>한편, <code>&lt;*&gt;</code> 연산자는 함수를 반환하는 상태 변환자를 인자를 반환하는 상태 변환자에 적용하여, 그 함수를 인자에 적용한 결과를 반환하는 상태 변환자를 만들어낸다.</p>
<p><img decoding="async" loading="lazy" alt="img5" src="https://dream2405.github.io/blog/assets/images/image-5-a4d4951de85e2ef7d7a88b806cf1ed42.png" width="1355" height="450" class="img_ev3q"></p>
<p>기호 <code>$</code>는 일반적인 함수 적용을 나타내며, <code>f $ x</code> = <code>f x</code>로 정의된다.</p>
<p>마지막으로, <code>ST</code>에 대한 모나드 인스턴스는 다음과 같이 선언된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">instance</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- (&gt;&gt;=) :: ST a -&gt; (a -&gt; ST b) -&gt; ST b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token hvariable">st</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">s</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">s'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">app</span><span class="token plain"> </span><span class="token hvariable">st</span><span class="token plain"> </span><span class="token hvariable">s</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token hvariable">app</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token hvariable">s'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>즉, <code>st &gt;&gt;= f</code>는 상태 변환자 <code>st</code>를 초기 상태 <code>s</code>에 적용한 다음, 그 결과 값 <code>x</code>에 함수 <code>f</code>를 적용하여 새로운 상태 변환자 <code>f x</code>를 얻는다. 그리고 이 <code>f x</code>를 새로운 상태 <code>s'</code>에 적용하여 최종 결과를 얻는다.</p>
<p><img decoding="async" loading="lazy" alt="img6" src="https://dream2405.github.io/blog/assets/images/image-6-a4ab6fdf75c28e8d666755be6132af00.png" width="977" height="339" class="img_ev3q"></p>
<p>이런 방식으로, 상태 모나드의 <strong>바인드(bind) 연산자(&gt;&gt;=)</strong> 는 상태 변환자들의 순차적 실행과 그 결과 값의 처리를 통합한다. <code>&gt;&gt;=</code>의 정의 내에서는 첫 번째 인자의 결과 값 <code>x</code>에 따라 동작이 달라질 수 있는 새로운 상태 변환자 <code>f x</code>를 만들어내는 반면, <code>&lt;*&gt;</code>에서는 인자로 명시적으로 제공된 상태 변환자만 사용하도록 제한된다는 점에 주목해야 한다. 따라서 <code>&gt;&gt;=</code> 연산자를 사용하면 더 큰 유연성을 얻을 수 있다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="relabelling-trees">Relabelling trees<a href="https://dream2405.github.io/blog/monads-and-more/#relabelling-trees" class="hash-link" aria-label="Relabelling trees에 대한 직접 링크" title="Relabelling trees에 대한 직접 링크">​</a></h3>
<p>stateful programming의 한 예시로서, 트리의 라벨을 다시 붙이는 함수를 개발해 보자.<br>
<!-- -->이를 위해 다음 타입을 사용한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">deriving</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Show</span><br></span></code></pre></div></div>
<p>예를 들어, 다음과 같이 정의할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">tree</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Char</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">tree</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token char string" style="color:#e3116c">'a'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token char string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token char string" style="color:#e3116c">'c'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>이제 이런 트리 내의 각 리프(leaf)를 고유한, 즉 새로운(fresh) 정수로 재라벨링하는 함수를 정의하는 문제를 생각해 보자. 하스켈과 같은 순수 언어에서는 다음에 사용할 새 정수를 추가 인자로 받고, 그 다음 사용할 정수를 추가 결과로 반환하는 방식으로 이를 구현할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">rlabel</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">rlabel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">rlabel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token plain"> </span><span class="token hvariable">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token hvariable">l'</span><span class="token plain"> </span><span class="token hvariable">r'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">n''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">l'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">n'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">rlabel</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">r'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token hvariable">n''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">rlabel</span><span class="token plain"> </span><span class="token hvariable">r</span><span class="token plain"> </span><span class="token hvariable">n'</span><br></span></code></pre></div></div>
<p>그러면, 이 예시에서는 다음과 같은 결과를 얻는다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fst</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">rlabel</span><span class="token plain"> </span><span class="token hvariable">tree</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>하지만 <code>rlabel</code>의 정의는 정수 상태를 계산 과정 전체에 걸쳐 명시적으로 전달해야 할 필요성 때문에 복잡하다. 더 간단한 정의를 얻기 위해, 먼저 <code>Tree a -&gt; Int -&gt; (Tree Int, Int)</code> 타입이 상태 변환자 타입을 사용하여 <code>Tree a -&gt; ST (Tree Int)</code>로 다시 작성될 수 있다는 점에 주목한다. 여기서 상태는 다음에 사용할 새 정수이다. 이러한 다음 정수는 현재 상태를 결과로, 그리고 다음 정수를 새로운 상태로 반환하는 상태 변환자를 정의함으로써 생성할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">fresh</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">fresh</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>ST</code>가 어플리커티브 펑터라는 사실을 이용하여, 이제 어플리커티브 스타일로 작성된 새로운 버전의 재라벨링 함수를 정의할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">alabel</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">alabel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;$&gt;</span><span class="token plain"> </span><span class="token hvariable">fresh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">alabel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token plain"> </span><span class="token hvariable">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;$&gt;</span><span class="token plain"> </span><span class="token hvariable">alabel</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;*&gt;</span><span class="token plain"> </span><span class="token hvariable">alabel</span><span class="token plain"> </span><span class="token hvariable">r</span><br></span></code></pre></div></div>
<p>(참고: <code>g &lt;$&gt; x &lt;*&gt; y</code>는 <code>pure g &lt;*&gt; x &lt;*&gt; y</code>와 동일하게 동작한다.)<br>
<!-- -->이 새로운 버전은 이전과 동일한 결과를 준다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">fst</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">app</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">alabel</span><span class="token plain"> </span><span class="token hvariable">tree</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>하지만 그 정의는 훨씬 더 간단하다. 기본 케이스(base case)에서는 이제 <code>Leaf</code> 생성자를 다음 새 정수에 적용하기만 하면 되고, 재귀 케이스에서는 두 서브트리를 라벨링한 결과에 <code>Node</code> 생성자를 적용한다. 특히, 프로그래머는 더 이상 정수 상태를 계산 과정에 일일이 전달하는 지루하고 오류가 발생하기 쉬운 작업에 대해 걱정할 필요가 없다. 이 작업은 어플리커티브 메커니즘에 의해 자동으로 처리되기 때문이다.</p>
<p><code>ST</code>가 모나드이기도 하다는 사실을 이용하여, <code>do</code> 표기법을 사용해 이와 동일한 기능의 모나드 버전 재라벨링 함수를 정의할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">mlabel</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ST</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Tree</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">mlabel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">fresh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">mlabel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token plain"> </span><span class="token hvariable">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">l'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mlabel</span><span class="token plain"> </span><span class="token hvariable">l</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token hvariable">r'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mlabel</span><span class="token plain"> </span><span class="token hvariable">r</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token hvariable">l'</span><span class="token plain"> </span><span class="token hvariable">r'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>이 정의는 중간 결과에 이름을 붙여줘야 한다는 점을 제외하면 어플리커티브 버전과 유사하다. <code>rlabel</code>과 같은 비-제네릭(non-generic) 함수가 어플리커티브와 모나드 스타일 모두로 정의될 수 있을 때, 어떤 정의를 선호할지는 대체로 취향의 문제이다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generic-functions">Generic functions<a href="https://dream2405.github.io/blog/monads-and-more/#generic-functions" class="hash-link" aria-label="Generic functions에 대한 직접 링크" title="Generic functions에 대한 직접 링크">​</a></h3>
<p>모나드라는 개념을 추상화함으로써 얻는 중요한 이점은 어떤 모나드에든 사용할 수 있는 <strong>제네릭 함수(generic function)</strong> 를 정의할 수 있다는 것이다. <code>Control.Monad</code> 라이브러리에는 다수의 그런 함수들이 제공된다.<br>
<!-- -->예를 들어, 리스트에 대한 <code>map</code> 함수의 모나드 버전은 다음과 같이 정의할 수 있다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">mapM</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">b</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">mapM</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">mapM</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">y</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token hvariable">ys</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token builtin">mapM</span><span class="token plain"> </span><span class="token hvariable">f</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">y</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">ys</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>mapM</code>은 인자로 받는 함수와 함수 자체의 반환 타입이 이제 모나드 타입이라는 점을 제외하면 <code>map</code>과 동일한 타입을 갖는다는 점에 주목하자. 이것이 어떻게 사용될 수 있는지 설명하기 위해, 주어진 문자가 숫자일 경우에만 그 문자를 해당하는 숫자 값으로 변환하는 함수를 생각해 보자.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">conv</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Maybe</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">conv</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">isDigit</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">digitToInt</span><span class="token plain"> </span><span class="token hvariable">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">otherwise</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><br></span></code></pre></div></div>
<p>(<code>isDigit</code>와 <code>digitToInt</code> 함수는 <code>Data.Char</code>에서 제공된다.) <code>mapM</code>을 <code>conv</code> 함수에 적용하면 숫자 문자열을 해당하는 숫자 값의 리스트로 변환하는 수단을 얻게 된다. 이 변환은 문자열의 모든 문자가 숫자일 경우에만 성공하고, 그렇지 않으면 실패한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">mapM</span><span class="token plain"> </span><span class="token hvariable">conv</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1234"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">mapM</span><span class="token plain"> </span><span class="token hvariable">conv</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"123a"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Nothing</span><br></span></code></pre></div></div>
<p>다음으로, 리스트에 대한 <code>filter</code> 함수의 모나드 버전은 <code>mapM</code>과 유사한 방식으로 타입과 정의를 일반화하여 정의된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">filterM</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">filterM</span><span class="token plain"> </span><span class="token hvariable">p</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">filterM</span><span class="token plain"> </span><span class="token hvariable">p</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">x</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">xs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">p</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token hvariable">ys</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">filterM</span><span class="token plain"> </span><span class="token hvariable">p</span><span class="token plain"> </span><span class="token hvariable">xs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token hvariable">b</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token hvariable">x</span><span class="token operator" style="color:#393A34">:</span><span class="token hvariable">ys</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token hvariable">ys</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>예를 들어, 리스트 모나드의 경우 <code>filterM</code>을 사용하면 리스트의 <strong>멱집합(powerset)</strong> 을 특히 간결하게 계산하는 수단을 얻을 수 있다. 멱집합은 리스트의 각 원소를 포함하거나 제외하는 모든 가능한 경우의 수로 주어진다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">filterM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>마지막 예로, 리스트에 대한 <code>prelude</code> 함수 <code>concat :: [[a]] -&gt; [a]</code>는 임의의 모나드에 대해 다음과 같이 <code>join</code> 함수로 일반화된다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">join</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Monad</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token hvariable">m</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">join</span><span class="token plain"> </span><span class="token hvariable">mmx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mmx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token hvariable">x</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token hvariable">mx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin">return</span><span class="token plain"> </span><span class="token hvariable">x</span><br></span></code></pre></div></div>
<p>이 함수는 중첩된 모나드 값을 일반 모나드 값으로 평탄화(flatten)한다. 리스트 모나드에 대해서는 <code>concat</code>과 동일한 방식으로 동작하는 한편, <code>Maybe</code> 모나드에 대해서는 바깥쪽과 안쪽 값 모두 성공(<code>Just</code>)일 경우에만 성공한다.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">join</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">join</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">join</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Just</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token hvariable">join</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">Nothing</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monad-laws">Monad laws<a href="https://dream2405.github.io/blog/monads-and-more/#monad-laws" class="hash-link" aria-label="Monad laws에 대한 직접 링크" title="Monad laws에 대한 직접 링크">​</a></h3>
<p>펑터나 어플리커티브와 비슷한 방식으로, 두 모나드 기본 연산(primitive)은 몇 가지 등식 법칙을 만족해야 한다.</p>
<ul>
<li><code>return x &gt;&gt;= f</code> = <code>f x</code></li>
<li><code>mx &gt;&gt;= return</code> = <code>mx</code></li>
<li><code>(mx &gt;&gt;= f) &gt;&gt;= g</code> = <code>mx &gt;&gt;= (\x -&gt; (f x &gt;&gt;= g))</code></li>
</ul>
<p>첫 두 등식은 <code>return</code>과 <code>&gt;&gt;=</code> 사이의 관계에 대한 것이다.</p>
<p><strong>첫 번째 등식(좌항등원, Left identity)</strong> 은, 어떤 값을 <code>return</code>한 뒤 그 결과를 모나드 함수에 넘기는 것은 단순히 그 함수를 값에 적용하는 것과 같은 결과를 주어야 한다는 것을 나타낸다.</p>
<p><strong>두 번째 등식(우항등원, Right identity)</strong> 은, 모나드 계산의 결과를 <code>return</code> 함수에 넘기는 것은 단순히 그 계산을 수행하는 것과 같은 결과를 주어야 한다는 것을 나타낸다.</p>
<p>종합하면, 이 두 등식은 (<code>&gt;&gt;=</code>의 두 번째 인자가 바인딩 연산을 포함한다는 점을 감안하면) <code>return</code>이 <code>&gt;&gt;=</code> 연산자에 대한 항등원(identity)이라는 것을 말해준다.</p>
<p><strong>세 번째 등식(결합법칙, Associativity)</strong> 은 <code>&gt;&gt;=</code>와 자신 사이의 관계에 대한 것으로, (<code>&gt;&gt;=</code>가 바인딩을 포함한다는 점을 다시 감안하면) <code>&gt;&gt;=</code>가 결합법칙을 만족함을 표현한다. 이 등식의 우변을 단순히 <code>mx &gt;&gt;= (f &gt;&gt;= g)</code>로 쓸 수는 없다는 점에 주목해야 하는데, 이는 타입 검사를 통과하지 못할 것이기 때문이다. 우리가 지금까지 봐온 모든 모나드는 위의 법칙들을 만족한다.</p>]]></content>
        <author>
            <name>dream2405</name>
        </author>
        <category label="Haskell" term="Haskell"/>
    </entry>
</feed>